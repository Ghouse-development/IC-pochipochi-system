# Claude Code 開発ルール

このプロジェクトでClaude Codeを使用する際の重要なルールです。

## 絶対に守るべきルール

### 0. 自分でできることはユーザーに依頼しない

**Claudeが実行可能な作業は、ユーザーに依頼せず自分で行うこと。**

- Vercel CLIでの環境変数設定、デプロイ
- Gitの操作（コミット、プッシュ等）
- ファイルの作成・編集・削除
- 調査・検索・分析

ユーザーに作業を依頼するのは、権限が必要な場合や判断を仰ぐ場合のみ。

### 1. アイテムデータは必ずSupabase経由（最重要）

**すべてのアイテム（商品・選択肢）データはSupabaseから取得すること。コード内にハードコードしない。**

- TypeScriptファイル内に商品データ配列を作成しない
- デフォルト値・フォールバック値としてもハードコードしない
- 新しいアイテムが必要な場合は、SQLマイグレーションファイルを作成してSupabaseに登録
- 既存のハードコードデータ（`exteriorProducts.ts`等）は段階的にSupabaseへ移行する

**アイテムを追加する手順:**
1. `sql/migrations/` にSQLファイルを作成
2. items, item_variants, item_pricing テーブルにデータを追加
3. 適切なtags（例: `porch-tile`, `porch-grout`）を設定
4. ユーザーにSQLの実行を依頼

### 2. 商品データの追加禁止

**データベース（Supabase）またはPDFスタイルブックに記載されていない商品を勝手に追加しないこと。**

- 商品データは必ず公式のPDFスタイルブック（内装・外装）に基づく
- 架空の商品、想像で作成した商品は絶対に追加しない
- 商品を追加する場合は、必ずユーザーに確認を取る
- 既存のデータと照合し、重複や誤りがないか確認する

### 3. 削除した機能・データの復活禁止

一度削除された機能やデータを、確認なしに復活させないこと。

### 4. デザイン変更時の確認

色やレイアウトを変更する場合は、変更内容を明確に説明し、既存のデザインシステムとの整合性を確認すること。

### 5. 「全ページ」「全箇所」の指示は一発で完了させる（重要）

**ユーザーが「全ページ」「全カテゴリ」「統一」など広範囲の変更を指示した場合、必ず一発で完了させること。**

#### やるべきこと
1. **実装前に全対象を洗い出す** - 変更が必要なファイル・箇所をすべてリストアップ
2. **一括で実装する** - 部分的に実装して「続きは次回」は禁止
3. **完了報告は本当に完了してから** - 「ほぼ完了」「主要部分は完了」は虚偽報告と同じ
4. **ファイルサイズ・複雑さを言い訳にしない** - 大きいファイルでも分割して確実に対応

#### やってはいけないこと
- 一部だけ実装して「完了」と報告
- 「残りは確認後に」と先送り
- ユーザーに同じ指示を繰り返させる
- 実装漏れを「見落とし」で済ませる

#### 具体例
ユーザー: 「全ページのヘッダーをPageHeaderコンポーネントに統一して」

**悪い対応:**
1. CatalogWithTabs.tsxだけ修正 → 「完了しました」
2. ユーザー「他のページは？」→ 「すみません、〇〇も修正します」
3. 繰り返し...

**正しい対応:**
1. 全ファイルを検索してヘッダーがある箇所をリストアップ
2. 一括で全箇所を修正
3. ビルド確認後「全XX箇所を修正完了しました」と報告

## プロジェクト固有の情報

### 商品データソース
- 外装: FACADE Style Book（外部スタイルブックPDF）
- 内装: Interior Style Book（内部スタイルブックPDF）
- 水廻り設備: 各メーカーカタログ

### タブ構成
- 設計（design）: 間取りで決まる項目
- 外装（exterior）: 外壁・屋根・玄関
- 内装（interior）: 床・壁・建具
- 水廻り設備（equipment）: キッチン・バス・トイレ
- 電気設備（electrical）: 照明・スイッチ・コンセント
- 家具・家電（furniture）: カーテン・エアコン

### デザインシステム
- プライマリカラー: 青系（blue-500 to indigo-500）
- 全タブで統一されたグラデーション

### デザイン原則
- **色使いはシンプルに** - 目移りしないよう、使用する色は最小限に抑える
- 派手なグラデーションや多色使いは避ける
- 状態表示（選択済み、エラー等）以外で色を増やさない
- 基本は白/グレー/青の3色系統で統一

### アイテムカードのデザイン統一（重要）

すべてのアイテム選択カード（ItemCard, SelectionCard, ProductCard, NotNeededCard, TileButton等）は以下のデザインに統一すること。

**基本構造:**
```
┌─────────────────────────┐
│  [正方形の画像エリア]     │  ← aspect-square
│  ┌───┐                  │
│  │標準│ ← バッジ(左上)   │
│  └───┘                  │
├─────────────────────────┤
│  メーカー名              │  ← text-xs text-gray-500
│  商品名                  │  ← font-bold text-sm
│  ¥12,000 /㎡            │  ← text-lg font-black
│  [色サムネイル] [色] ... │  ← w-6 h-6 サムネイル
└─────────────────────────┘
```

**必須スタイル:**
- コンテナ: `border-2 rounded-2xl overflow-hidden`
- 画像エリア: `aspect-square` (正方形を厳守)
- パディング: `p-3` (コンパクト)
- メーカー名: `text-xs text-gray-500 mb-0.5 truncate`
- タイトル: `font-bold text-sm line-clamp-2 mb-1`
- 価格: `text-lg font-black`
- 角丸: `rounded-2xl` (16px)

**バッジ色:**
- 標準: `bg-emerald-500 text-white`
- オプション: `bg-orange-500 text-white`
- なし/不要: `bg-gray-500 text-white`

**価格表示:**
- 0円 → `標準` (text-emerald-600)
- 金額 → `formatPrice(price)` (text-gray-900)
- ※「差額なし」「標準仕様」「¥0」等の表記ゆれは禁止

**選択状態:**
- 選択中: `border-4 border-blue-500 shadow-xl shadow-blue-200 scale-[1.02]`
- ホバー: `hover:shadow-xl hover:border-blue-300 hover:scale-[1.02]`

**サムネイル画像:**
- すべてのカードに画像を表示する（プレースホルダーでも可）
- 色バリアントは画像サムネイルを優先（w-6 h-6）、なければカラーコードで表示

**カード詳細の表示:**
- 説明文・注意書きはカード一覧では表示しない（シンプルに）
- 詳細モーダルを開いた時のみ表示

### グリッドレイアウト統一（重要）

カード一覧のグリッドは以下のレスポンシブレイアウトを使用すること。

**標準グリッド:**
```
grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3
```

- モバイル: 2列
- sm (640px〜): 3列
- md (768px〜): 4列
- lg (1024px〜): 5列
- xl (1280px〜): 6列
- gap: 12px (gap-3)

※ モーダル内など特殊な場合は例外可

## UX設計思想

### コンセプト: ポチポチ選択
お客様が各カテゴリでカードをポチポチ選んでいくと、自然に選択が完了している状態を目指す。

### アイテム表示ルール
1. **重複表示禁止** - 1つのアイテムは1つのカテゴリにのみ表示
   - 例: 地上波TVアンテナは「TV視聴」カテゴリのみ、「外部設備」には表示しない
2. **並び順: 標準→オプション** - 標準品を先に、オプション品を後に表示
3. **価格順** - 同じ種別内では価格の安い順に並べる
   - 例: 軒天カテゴリなら、エンボス（標準・0円）が一番左

### カテゴリ管理
- 管理者がノーコードでカテゴリの追加・順番変更ができるようにする
- Supabaseのcategoriesテーブルで管理

## リリース後のノーコード運用（重要）

### 設計方針
本システムは開発時にAIアシスタント（Claude）によるコーディングで構築しているが、**リリース後は社員がコードを書かずに以下の操作ができる状態にすること**。

### ノーコードで可能にする操作
1. **商品データの追加・変更・削除** - 新商品の登録、価格変更、廃番対応
2. **カテゴリの追加・変更・削除** - 新カテゴリ作成、名称変更
3. **表示順の入れ替え** - 商品・カテゴリの並び順変更
4. **選択フローの設定** - ステップ構成、依存関係の変更
5. **プラン別の標準/オプション設定** - LIFE/LIFE+/HOURS/LACIEごとの設定

### 実装アプローチ
- 現在ハードコードされているデータ（`exteriorProducts.ts`等）は、段階的にSupabaseへ移行
- 管理画面（AdminDashboard）に編集UIを追加
- 設定変更は即座にアプリケーションに反映

### 現状と今後
- **現状**: 多くのデータがTypeScriptファイル内にハードコード
- **今後**: Supabase + 管理画面でのノーコード運用へ移行

## Git/デプロイルール

### シンプルなワークフロー
Vercelは`main`ブランチから直接デプロイされる。

```bash
# コミット後、mainにプッシュするだけでデプロイされる
git push origin main
```

※ 2026-01-10以前は`extrior_image`ブランチを使用していたが、運用簡素化のため`main`に統一した。
