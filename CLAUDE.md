# Claude Code 開発ルール

このプロジェクトでClaude Codeを使用する際の重要なルールです。

## 絶対に守るべきルール

### 0. 自分でできることはユーザーに依頼しない

**Claudeが実行可能な作業は、ユーザーに依頼せず自分で行うこと。**

- Vercel CLIでの環境変数設定、デプロイ
- Gitの操作（コミット、プッシュ等）
- ファイルの作成・編集・削除
- 調査・検索・分析

ユーザーに作業を依頼するのは、権限が必要な場合や判断を仰ぐ場合のみ。

### 1. アイテムデータは必ずSupabase経由（最重要）

**すべてのアイテム（商品・選択肢）データはSupabaseから取得すること。コード内にハードコードしない。**

- TypeScriptファイル内に商品データ配列を作成しない
- デフォルト値・フォールバック値としてもハードコードしない
- 新しいアイテムが必要な場合は、SQLマイグレーションファイルを作成してSupabaseに登録
- 既存のハードコードデータ（`exteriorProducts.ts`等）は段階的にSupabaseへ移行する

**アイテムを追加する手順:**
1. `sql/migrations/` にSQLファイルを作成
2. items, item_variants, item_pricing テーブルにデータを追加
3. 適切なtags（例: `porch-tile`, `porch-grout`）を設定
4. ユーザーにSQLの実行を依頼

### 2. 商品データの追加禁止

**データベース（Supabase）またはPDFスタイルブックに記載されていない商品を勝手に追加しないこと。**

- 商品データは必ず公式のPDFスタイルブック（内装・外装）に基づく
- 架空の商品、想像で作成した商品は絶対に追加しない
- 商品を追加する場合は、必ずユーザーに確認を取る
- 既存のデータと照合し、重複や誤りがないか確認する

### 3. 削除した機能・データの復活禁止

一度削除された機能やデータを、確認なしに復活させないこと。

### 4. デザイン変更時の確認

色やレイアウトを変更する場合は、変更内容を明確に説明し、既存のデザインシステムとの整合性を確認すること。

### 5. 「全ページ」「全箇所」の指示は一発で完了させる（重要）

**ユーザーが「全ページ」「全カテゴリ」「統一」など広範囲の変更を指示した場合、必ず一発で完了させること。**

#### やるべきこと
1. **実装前に全対象を洗い出す** - 変更が必要なファイル・箇所をすべてリストアップ
2. **一括で実装する** - 部分的に実装して「続きは次回」は禁止
3. **完了報告は本当に完了してから** - 「ほぼ完了」「主要部分は完了」は虚偽報告と同じ
4. **ファイルサイズ・複雑さを言い訳にしない** - 大きいファイルでも分割して確実に対応

#### やってはいけないこと
- 一部だけ実装して「完了」と報告
- 「残りは確認後に」と先送り
- ユーザーに同じ指示を繰り返させる
- 実装漏れを「見落とし」で済ませる

#### 具体例
ユーザー: 「全ページのヘッダーをPageHeaderコンポーネントに統一して」

**悪い対応:**
1. CatalogWithTabs.tsxだけ修正 → 「完了しました」
2. ユーザー「他のページは？」→ 「すみません、〇〇も修正します」
3. 繰り返し...

**正しい対応:**
1. 全ファイルを検索してヘッダーがある箇所をリストアップ
2. 一括で全箇所を修正
3. ビルド確認後「全XX箇所を修正完了しました」と報告

### 6. 本番URLとプレビューURLの区別（重要）

**確認・デプロイ時は必ずProduction URLを使用すること。**

| 種類 | URL | 用途 |
|------|-----|------|
| **Production（本番）** | `https://ic-pochipochi-system.vercel.app/` | ユーザーが使用するURL。これを使用すること |
| Preview（プレビュー） | `https://ic-pochipochi-system-git-main-...vercel.app/` | Deployment Protection有効で401エラーになる。使用禁止 |

**やってはいけないこと:**
- Preview URL（`-git-main-`を含むURL）をユーザーに案内する
- Preview URLでの動作確認をもって「完了」と報告する
- URLの種類を確認せずに作業を進める

**Supabase情報:**
- Project: `IC-pochipochi-system`
- Reference ID: `qqzqffkiyzeaampotgnn`
- URL: `https://qqzqffkiyzeaampotgnn.supabase.co`

**ログイン情報:**
- Email: `hn@g-house.osaka.jp`
- Password: `Ghouse0648`

### 7. 実装前・実装後の確認ルール（重要）

**指示を受けたら、まず現状を確認してから実装すること。**

**実装前:**
1. スクリーンショットまたは実際のURLで現状を確認する
2. 指示内容を具体的な変更箇所として列挙する
3. 不明点があれば必ず確認を取る

**実装後:**
1. ビルド成功だけでなく、本番URL（Production）で画面を確認する
2. 変更前後の差分をユーザーに説明できる状態にする
3. 「完了」と報告する前に、指示内容を全て満たしているか照合する

**やってはいけないこと:**
- コードだけ見て「理解した」と思い込む
- ビルド成功を「実装完了」と混同する
- 画面確認せずに「完了」と報告する

### 8. 不明点は1問ずつ質問する（重要）

**分からないことがあれば、推測で実装せず、1問ずつユーザーに質問すること。**

- 曖昧な指示は確認してから実装する
- 複数の解釈が可能な場合は、選択肢を提示して確認を取る
- 「たぶんこうだろう」で進めない
- 質問は1つずつ、具体的に行う（まとめて質問しない）

**これが一発で改善させるコツ。**

## プロジェクト固有の情報

### 商品データソース
- 外装: FACADE Style Book（外部スタイルブックPDF）
- 内装: Interior Style Book（内部スタイルブックPDF）
- 水廻り設備: 各メーカーカタログ

### タブ構成
- 設計（design）: 間取りで決まる項目
- 外装（exterior）: 外壁・屋根・玄関
- 内装（interior）: 床・壁・建具
- 水廻り設備（equipment）: キッチン・バス・トイレ
- 電気設備（electrical）: 照明・スイッチ・コンセント
- 家具・家電（furniture）: カーテン・エアコン

### デザインシステム
- プライマリカラー: 青系（blue-500 to indigo-500）
- 全タブで統一されたグラデーション

### デザイン原則
- **色使いはシンプルに** - 目移りしないよう、使用する色は最小限に抑える
- 派手なグラデーションや多色使いは避ける
- 状態表示（選択済み、エラー等）以外で色を増やさない
- 基本は白/グレー/青の3色系統で統一

### 9. 選択カードは必ずSelectionCardを使用する（重要）

**選択カードを新規作成する際は、必ず `SelectionCard.tsx` コンポーネントを使用すること。**

- カスタムボタンやカードの新規作成は禁止
- 既存のセレクター（StairSelector, EntranceDoorSelector等）を参考にする
- SelectionCardのpropsで対応できない場合は、SelectionCard自体を拡張する

**理由:** カードのデザイン統一を維持するため。SelectionCardを唯一の選択カードコンポーネントとする。

### アイテムカードのデザイン統一（重要）

**SelectionCard.tsx が唯一の選択カードコンポーネント。** 以下のデザインに統一されている。

**基本構造:**
```
┌─────────────────────────┐
│  [正方形の画像エリア]     │  ← aspect-square
│  ┌───┐                  │
│  │標準│ ← バッジ(左上)   │
│  └───┘                  │
├─────────────────────────┤
│  メーカー名              │  ← text-xs text-gray-500
│  商品名                  │  ← font-bold text-sm
│  ¥12,000 /㎡            │  ← text-lg font-black
│  [色サムネイル] [色] ... │  ← w-6 h-6 サムネイル
└─────────────────────────┘
```

**必須スタイル:**
- コンテナ: `border border-gray-200 rounded-lg overflow-hidden`
- 画像エリア: `aspect-square` (正方形を厳守)
- 情報エリア: `p-2`
- タイトル: `font-bold text-xs text-gray-800 line-clamp-2 min-h-[2rem]`
- 角丸: `rounded-lg`

**バッジ:**
- 位置: `absolute top-1 left-1`
- スタイル: `px-1.5 py-0.5 rounded text-[10px] font-bold`
- 標準: `bg-emerald-500 text-white`
- なし/不要: `bg-gray-500 text-white`
- ※「オプション」バッジは表示しない（標準のみ表示）

**チェックマーク（選択時）:**
- 位置: `absolute top-1 right-1`
- スタイル: `bg-blue-500 rounded-full p-1` + `w-3 h-3` アイコン

**価格表示:**
- 0円 → `標準` (text-emerald-600)
- 金額 → `formatPrice(price)` (text-gray-900)
- ※「差額なし」「標準仕様」「¥0」等の表記ゆれは禁止

**選択状態:**
- 選択中: `border-2 border-blue-500 shadow-lg`
- ホバー: `hover:border-blue-300 hover:shadow-md`

**サムネイル画像:**
- すべてのカードに画像を表示する（プレースホルダーでも可）
- 色バリアントは画像サムネイルを優先（w-6 h-6）、なければカラーコードで表示

**カード詳細の表示:**
- 説明文・注意書きはカード一覧では表示しない（シンプルに）
- 詳細モーダルを開いた時のみ表示

### グリッドレイアウト統一（重要）

カード一覧のグリッドは6列固定を使用すること。

**標準グリッド:**
```
grid grid-cols-6 gap-2
```

- PC・タブレット: 6列固定（横6個×縦2行=12アイテム/ページ）
- gap: 8px (gap-2)
- ページネーション: 12アイテムを超える場合は次ページへ

**ページ構成:**
- ヘッダー: メインメッセージ + サブメッセージ（2行のみ）
- ステップインジケーター等の余分な見出しは表示しない
- カード: サムネイル、アイテム名、種類数、金額（0円は「標準」）、単位のみ

## UX設計思想

### コンセプト: ポチポチ選択
お客様が各カテゴリでカードをポチポチ選んでいくと、自然に選択が完了している状態を目指す。

### アイテム表示ルール
1. **重複表示禁止** - 1つのアイテムは1つのカテゴリにのみ表示
   - 例: 地上波TVアンテナは「TV視聴」カテゴリのみ、「外部設備」には表示しない
2. **並び順: 標準→オプション** - 標準品を先に、オプション品を後に表示
3. **価格順** - 同じ種別内では価格の安い順に並べる
   - 例: 軒天カテゴリなら、エンボス（標準・0円）が一番左

### カテゴリ管理
- 管理者がノーコードでカテゴリの追加・順番変更ができるようにする
- Supabaseのcategoriesテーブルで管理

## リリース後のノーコード運用（重要）

### 設計方針
本システムは開発時にAIアシスタント（Claude）によるコーディングで構築しているが、**リリース後は社員がコードを書かずに以下の操作ができる状態にすること**。

### ノーコードで可能にする操作
1. **商品データの追加・変更・削除** - 新商品の登録、価格変更、廃番対応
2. **カテゴリの追加・変更・削除** - 新カテゴリ作成、名称変更
3. **表示順の入れ替え** - 商品・カテゴリの並び順変更
4. **選択フローの設定** - ステップ構成、依存関係の変更
5. **プラン別の標準/オプション設定** - LIFE/LIFE+/HOURS/LACIEごとの設定

### 実装アプローチ
- 現在ハードコードされているデータ（`exteriorProducts.ts`等）は、段階的にSupabaseへ移行
- 管理画面（AdminDashboard）に編集UIを追加
- 設定変更は即座にアプリケーションに反映

### 現状と今後
- **現状**: 多くのデータがTypeScriptファイル内にハードコード
- **今後**: Supabase + 管理画面でのノーコード運用へ移行

## Git/デプロイルール

### シンプルなワークフロー
Vercelは`main`ブランチから直接デプロイされる。

```bash
# コミット後、mainにプッシュするだけでデプロイされる
git push origin main
```

※ 2026-01-10以前は`extrior_image`ブランチを使用していたが、運用簡素化のため`main`に統一した。
