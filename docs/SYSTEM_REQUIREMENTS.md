# IC-pochipochi-system 要件定義書

## 1. システム概要

### 1.1 システム名
IC-pochipochi-system（ICポチポチシステム）

### 1.2 目的
Gハウスの規格住宅における内装・外装・設備のアイテム選択と見積作成を効率化するWebシステム

### 1.3 対象ユーザー
- **管理者（Gハウス側）**: admin, coordinator
- **お客様**: エンドユーザー（施主）

---

## 2. ユーザー区分と権限

### 2.1 管理者側（Gハウス）

| 役割 | 権限 |
|------|------|
| admin | 全機能利用可能（ユーザー管理、マスタ管理、全プロジェクト操作） |
| coordinator（IC担当） | 担当プロジェクトのみ操作可能、確定取消可能 |

### 2.2 お客様側

| 役割 | 権限 |
|------|------|
| user | アイテム閲覧・選択、見積確認、確定（確定後は変更不可） |

### 2.3 認証方式
- ログイン認証（メールアドレス + パスワード）
- 1プロジェクトに複数のお客様がアクセス可能（夫婦など）

---

## 3. 機能要件

### 3.1 管理者側機能

#### 3.1.1 ユーザー管理
- クライアント（お客様）の追加・編集・削除
- 社内ユーザーの追加・編集・削除
- 役割（admin / coordinator）の設定
- クライアント一括アップロード（CSV/Excel）

#### 3.1.2 プロジェクト管理
- プロジェクト作成・編集・削除
- 建物情報の設定
  - 一般情報（お客様、工事名、建築地、地域区分）
  - 仕様（耐火仕様、商品、工法）
  - 建物詳細（階数、天井高、構造、規格）
  - 各種申請
  - アクセントクロス設定
- 外装・内装・設備の詳細設定
- 担当coordinator（IC）の割り当て

#### 3.1.3 マスタ管理
- **商品（プラン）管理**: 追加・編集・削除（LIFE, LIFE+, HOURS, LACIE, LIFE X など）
- **カテゴリ管理**: 外装・内装・設備・その他
- **アイテム管理**
  - 基本情報: 品名、品目、品番、注釈
  - 単位: ㎡、個、箇所、セット、一式
  - 価格タイプ: 標準（0円）/ オプション（追加料金）
  - HIT設定: おすすめ・推奨アイテムのフラグ
  - 計算式: アイテムごとに自由設定（単価×数量＋施工費など）
  - 画像: 色名ごとに1画像
  - 商品別価格・利用可否設定
- **部屋管理**: 自由に追加・編集可能

#### 3.1.4 分析ダッシュボード
- お客様単位の閲覧履歴
- 期間別アイテム選択統計（人気ランキング、低選択アイテム）
- 統計データのExcelエクスポート

#### 3.1.5 レポート出力
| ドキュメント | サイズ | 形式 | 内容 |
|--------------|--------|------|------|
| 見積書 | A4 | Excel | 価格一覧、合計金額（税抜＋消費税） |
| 仕様書 | A3 | Excel | 建物情報、選択アイテム一覧（画像付き）、部屋ごと内装仕様 |
| プレゼン資料 | A3 | Excel | 建物情報、選択アイテム一覧（画像付き）、部屋ごと内装仕様、会社ロゴ |

#### 3.1.6 通知機能
- プロジェクト作成時 → お客様にメール通知
- お客様確定時 → 担当ICにメール通知

### 3.2 お客様側機能

#### 3.2.1 アイテム閲覧・選択
- カテゴリ別アイテム一覧表示（外装・内装・設備・その他）
- 商品（プラン）に応じたアイテム表示
- 画像・色バリエーション表示
- 標準（0円）/ オプション（追加料金）の表示
- HIT（おすすめ）アイテムの強調表示

#### 3.2.2 価格計算
- リアルタイム価格積み上げ表示
- 税抜価格で計算、最後に消費税加算
- 合計金額の常時表示

#### 3.2.3 選択商品の見える化
- カテゴリ別選択状況
- 部屋ごとの内装仕様表示
  - 床
  - 壁クロス
  - 天井クロス
  - 巾木
  - その他部材

#### 3.2.4 見積確認・確定
- 選択内容の一覧確認
- 確定ボタンで確定（確定後はお客様による変更不可）
- 確定取消はIC担当のみ可能

#### 3.2.5 ドキュメントダウンロード
- 見積書（Excel/A4）
- 仕様書（Excel/A3）
- プレゼン資料（Excel/A3）

---

## 4. データ構造

### 4.1 主要エンティティ

#### ユーザー関連
- **users**: ユーザー情報（お客様・社内ユーザー共通）
- **roles**: 役割（admin, coordinator, user）

#### プロジェクト関連
- **projects**: プロジェクト情報
- **project_members**: プロジェクト参加者（複数お客様対応）
- **project_settings**: 建物詳細設定

#### 商品・アイテム関連
- **products**: 商品（プラン）マスタ
- **categories**: カテゴリ（外装・内装・設備・その他）
- **items**: アイテムマスタ
- **item_variants**: アイテムの色バリエーション
- **item_images**: アイテム画像
- **item_pricing**: 商品別アイテム価格
- **item_formulas**: アイテム別計算式

#### 選択・見積関連
- **selections**: お客様のアイテム選択
- **estimates**: 見積情報

#### 分析関連
- **view_logs**: 閲覧履歴
- **audit_logs**: 変更履歴

#### 部屋関連
- **rooms**: 部屋マスタ
- **room_selections**: 部屋ごとの内装選択

### 4.2 アイテム属性

| 属性 | 説明 | 型 |
|------|------|-----|
| id | アイテムID | UUID |
| name | 品名 | string |
| category | 品目 | string |
| code | 品番 | string |
| note | 注釈 | string |
| unit | 単位（㎡/個/箇所/セット/一式） | enum |
| is_standard | 標準かどうか | boolean |
| is_hit | HIT（おすすめ）かどうか | boolean |
| formula | 計算式 | string |
| is_required | 必須カテゴリかどうか | boolean |

---

## 5. 非機能要件

### 5.1 対応環境
- PC（ブラウザ）: Chrome, Edge, Safari, Firefox
- スマホ・タブレット: レスポンシブ対応

### 5.2 言語
- 日本語のみ

### 5.3 セキュリティ
- ログイン認証
- 役割ベースアクセス制御（RBAC）
- HTTPS通信

### 5.4 データ管理
- 変更履歴の保存（誰がいつ何を変更したか）
- 定期バックアップ

---

## 6. 画面構成

### 6.1 管理者側

```
ログアウト | ユーザー管理 | プロジェクト | [マスタ管理] | [分析]
```

#### 画面一覧
1. ログイン画面
2. ユーザー管理
   - クライアント一覧/追加/編集
   - 社内ユーザー一覧/追加/編集
3. プロジェクト管理
   - プロジェクト一覧
   - プロジェクト作成/編集（ステップフォーム）
4. マスタ管理
   - 商品（プラン）管理
   - カテゴリ管理
   - アイテム管理
   - 部屋管理
5. 分析ダッシュボード
   - 閲覧履歴
   - 選択統計
6. チェックリスト確認（お客様の選択状況）
7. レポート出力

### 6.2 お客様側

#### 画面一覧
1. ログイン画面
2. アイテム選択画面
   - カテゴリサイドバー
   - アイテム一覧（カード形式）
   - 選択済みアイテム表示
   - 合計金額表示
3. 選択確認画面
   - 部屋ごとの内装仕様表示
   - 全選択アイテム一覧
4. 確定画面
5. ドキュメントダウンロード

---

## 7. 技術スタック

### 7.1 フロントエンド
- React 19
- TypeScript
- Vite
- Tailwind CSS
- Zustand（状態管理）
- Radix UI（UIコンポーネント）

### 7.2 バックエンド
- Supabase（PostgreSQL）
- Supabase Auth（認証）
- Supabase Storage（画像管理）

### 7.3 出力
- xlsx（Excel出力）

### 7.4 デプロイ
- Vercel
- GitHub（ソース管理）

---

## 8. 出力ドキュメント仕様

### 8.1 見積書（A4）
- 形式: Excel
- 内容:
  - ヘッダー（会社情報、日付、お客様情報）
  - 選択アイテム一覧（品名、品番、数量、単位、単価、金額）
  - 小計、消費税、合計金額

### 8.2 仕様書（A3）
- 形式: Excel
- 内容:
  - 建物情報
  - 選択アイテム一覧（画像付き）
  - 部屋ごとの内装仕様（床・壁クロス・天井クロス・巾木・その他）
- 価格情報は含めない

### 8.3 プレゼン資料（A3）
- 形式: Excel
- 内容:
  - 会社ロゴ
  - 建物情報
  - 選択アイテム一覧（画像付き）
  - 部屋ごとの内装仕様（画像付き）
- 価格情報は含めない

---

## 9. 通知仕様

| トリガー | 送信先 | 内容 |
|----------|--------|------|
| プロジェクト作成時 | お客様 | ログイン情報、システムURL |
| お客様確定時 | 担当IC | 確定通知、プロジェクトリンク |

---

## 10. 業務ワークフロー

### 10.1 全体フロー

```
設計者 → お客様 → ICコーディネーター → 確定 → 出力
```

### 10.2 詳細ステップ

| ステップ | 担当者 | 作業内容 |
|----------|--------|----------|
| ① 案件登録 | 設計者 | お客様情報、土地情報、建物情報、延床面積などを入力 |
| ② 設計カテゴリ選択 | 設計者 | 設計に関わるカテゴリ（天井高、小上がり、階段など）を選択 |
| ③ お客様招待 | システム | お客様にメールでシステムIDを送信、パスワード設定を依頼 |
| ④ アイテム選択 | お客様 | 外装・内装・設備の各アイテムを選択（基本的に全カテゴリを選択） |
| ⑤ IC打合せ | ICコーディネーター + お客様 | 選択アイテムの確認、仕様確認、金額確認、不足情報の補完 |
| ⑥ ショールーム情報追加 | ICコーディネーター | キッチン・バスなどショールームで決めた見積情報を入力 |
| ⑦ 仕様確定 | ICコーディネーター | 全体的な仕様・金額を確定 |
| ⑧ ドキュメント出力 | システム | 見積書・仕様書・内装プレゼンを自動生成 |

### 10.3 リアルタイム共有

- **お客様**: 途中段階での決定事項や見積をいつでも閲覧可能
- **スタッフ**: プロジェクトの進捗状況をリアルタイムで確認可能
- **権限**: Gハウス側は常に全プロジェクトを閲覧可能

### 10.4 利用状況トラッキング

スタッフは以下の情報を確認可能：
- ログイン履歴（いつログインしたか）
- 操作履歴（どのアイテムを閲覧・選択したか）
- 選択進捗（未確認カテゴリ一覧）

### 10.5 選択確認の仕組み

各カテゴリは以下のいずれかの状態を持つ：

| 状態 | 説明 |
|------|------|
| 未確認 | まだ選択されていない |
| 選択済み | 商品を選択し、必要に応じて部屋を指定 |
| 不要 | このカテゴリは設置しない（例：TVアンテナ、屋外カメラ） |

### 10.6 部屋別適用

内装アイテムは部屋別に適用を指定可能：
- 造作ニッチ → リビング、玄関
- アクセントクロス → 主寝室、子供部屋1
- カーテン → リビング、ダイニング、各居室

### 10.7 漏れ防止チェック

- 必須カテゴリの未選択アラート
- 打合せ前の選択状況サマリー
- 「不要」選択も明示的に記録

---

## 11. 今後の拡張可能性

- 多言語対応（英語など）
- 在庫管理機能
- Kintone連携
- 施工管理機能
- 顧客ポータル機能

---

*最終更新: 2025年12月27日*
*作成者: Claude Code*
