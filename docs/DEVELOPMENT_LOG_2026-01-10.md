# 開発記録 2026-01-10

## セッション概要
UI/UX改善とルール明文化

---

## 実装内容

### 1. 外壁カテゴリ改善
- 外壁カテゴリ選択時に常に3つの素材タイプカードを表示
  - 窯業系サイディング
  - ガルバリウム鋼板
  - 塗り壁
- 商品がない素材タイプは「準備中」と表示

### 2. タブ選択時の自動カテゴリ選択
- タブ（設計・外装・内装など）を切り替えた際に、サイドバーの一番上のカテゴリを自動選択
- メインページにカテゴリの内容が即座に表示される

### 3. ヘッダーコンパクト化
- 管理者ボタン行を削除し、ユーザーメニュー内に統合
- メイン画面のスペースを拡大
- 統合した機能：スタッフダッシュボード、階層表示、画像テスト、アイテムのメンテナンス

### 4. タブ帯色の統一
- 全タブを青系（from-blue-500 to-indigo-500）に統一
- シンプルで目移りしないデザインに

### 5. CLAUDE.md作成
開発ルールを明文化：

#### 絶対に守るべきルール
- データベース/PDFにない商品を勝手に追加しない
- 削除した機能・データを確認なしに復活させない
- デザイン変更時は既存システムとの整合性を確認

#### デザイン原則
- 色使いはシンプルに（白/グレー/青の3色系統）
- 派手なグラデーションや多色使いは避ける

#### UX設計思想
- コンセプト: ポチポチ選択（自然に選択完了）
- 重複表示禁止（1アイテム=1カテゴリ）
- 並び順: 標準→オプション、価格順
- カテゴリ管理: ノーコードで追加・順番変更可能

---

## E2Eテスト修正
- ルート名を修正: `/catalog/water` → `/catalog/equipment`
- CIの失敗を解消

---

## 確認事項・課題

### 玄関ドアの種類 ✅ 対応完了
PDFスタイルブックに基づき以下を追加:
- ドアデザイン: N08, N18, N15, C10（各色バリエーション付き）
- ハンドル形状: 5種類（電子錠用・手動錠用）
- オプション: 顔認証キー、インターフェースユニット

段階選択UI実装:
1. ドアデザイン選択カード（4つ）
2. ハンドル・オプション選択セクション
3. 選択後に商品一覧表示（戻るボタン付き）

### 今後の実装予定
1. アイテム重複表示の防止ロジック強化
2. 標準→オプション→価格順のソート実装
3. カテゴリ管理画面（ノーコード対応）

---

## コミット履歴
- `e5418af` feat: 外壁カテゴリ改善 & ヘッダーコンパクト化
- `cc703a8` style: タブの帯色を青系に統一
- `d6d7234` fix: E2Eテストのルート名を修正
- `82badf8` docs: CLAUDE.md追加 - 開発ルールを明文化
- `1d20a90` docs: デザイン原則を追加 - シンプルな色使い
- `f270962` feat: 玄関ドアデータ追加 - PDFスタイルブック準拠
- `2f9047e` feat: 玄関ドア段階選択UI追加 - ポチポチ選択対応

---

## セッション2: 管理者画面 & 認証フロー設計

### 1. プロジェクト詳細編集モーダル（ProjectEditModal）

G HOUSE Applicationスタイルの管理者用詳細編集モーダルを実装:

**新規ファイル:**
- `src/components/admin/ProjectEditModal.tsx` (1771行)

**実装セクション:**
1. 一般情報
   - クライアント（お客様名）
   - 建設（工事名、建築地）
   - 地域（防火区分、塩害区分、積雪区分）
   - 仕様（耐火仕様、商品、工法）
   - 建物詳細（階数、天井高）
   - 構造と規格（地盤改良、制振ダンパー、モジュール）
   - 各種申請（長期優良住宅、ZEH等）
   - アクセントクロス（総面積、無料/有料計算）

2. 外装・屋根・外壁・外部周り
   - 屋根、外部配管、破風・鼻隠し、庇
   - 軒天（A/B/C/D）
   - 軒樋・竪樋
   - ガレージシャッター（数量、防火、価格）

3. 外装・給排水
   - 1F/2F/3F 部屋別給排水設定

4. 外装・電気
   - 太陽光パネル（メーカー選択）
   - 蓄電池（メーカー選択）
   - 換気システム（給気・排気）

5. 内装全体の追加情報
   - ガス箇所、乾太くん
   - ダウンライト施工
   - 間接照明BOX、カーテンBOX
   - スイッチ・コンセント詳細

**UI特徴:**
- サイドバーナビゲーション（セクション間移動）
- 前へ/次へボタン
- 完了マーク表示
- ダークモード対応

### 2. ProjectManagerへの統合

- 歯車アイコン（Settings）で詳細編集モーダルを開く
- ペンアイコン（Edit）は従来の簡易編集
- 目アイコン（Eye）は詳細表示

### 3. 認証フロー設計

**決定事項: マジックリンク認証採用**

理由:
- 個人情報（お客様名）が見積・図面に記載される
- 1案件あたり約2ヶ月間継続利用
- 上場企業運用として適切なセキュリティ

**フロー:**
```
スタッフ → 案件作成 → お客様メール登録 → 招待メール送信
    ↓
お客様 → メール受信 → リンククリック → 自動ログイン
    ↓
セッション維持（14日）/ 再ログイン時は再度メールリンク
```

**実装予定:**
- リンク有効期限: 30分
- セッション維持: 14日
- 監査ログ: 全アクセス記録
- Supabase Auth使用

### 4. テスト案件

- 物件名: テスト様邸
- メールアドレス: hn@g-house.osaka.jp

---

## 次のステップ

1. マジックリンク認証の実装
2. お客様招待メール送信機能
3. お客様用ログインページ
4. 閲覧状況トラッキング
