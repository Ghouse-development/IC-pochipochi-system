# IC-pochipochi-system 開発記録

## プロジェクト概要
- **システム名**: IC-pochipochi-system（ぽちぽちシステム）
- **目的**: 住宅建材・設備の選定システム
- **対象ユーザー**: インテリアコーディネーター、顧客

## バージョン履歴

### v2.14.0 (2026-01-10)
- **ガス引込み連動機能**
  - 設計タブにガス引込み選択UI追加（あり/なし）
  - ガス無し選択時、乾太くん等ガス必須商品を自動非表示
  - requiresGasフラグによるフィルタリング実装
  - 乾太くんカテゴリ選択時、ガス未選択の場合は案内プロンプト表示
- **室内窓連動機能**
  - 設計タブに室内窓選択UI追加（あり/なし）
  - 「あり」選択時のみ内装タブで種類・ガラス選択可能
  - exteriorProducts.tsに室内窓商品データ追加
- **カテゴリ分類整理**
  - 乾太くんを家具・家電タブに移動
  - 室内窓をDESIGN_CATEGORIESに追加
  - 物干し金物は内装タブに残す（家具・家電ではない）
  - 電動ガレージシャッターに名称統一
- **商品データ拡充**
  - 玄関靴箱（コンポリア）を6色→14色に拡張
  - 乾太くんに「選択しない」オプション追加
- **分類ルール明確化**
  - 設計タブ：有無・種類の判断（ガス引込み、庇の有無と種類、室内窓の有無等）
  - 外装タブ：外観の色・仕上げ（ポーチタイル、庇の色等）
  - 内装タブ：室内の仕上げ（物干し、室内窓の種類・ガラス等）
- **言葉の揺らぎ調査**
  - 床材/ベース床、換気/換気システム等の揺らぎを検出（今後統一予定）

### v2.13.0 (2025-12-13)
- **革命的UI/UX強化**
  - クイックセレクトパネル: ワンクリックで標準品一括選択
  - キーボードショートカット: 生産性向上（Alt+1/2/3でタブ切替等）
- **他部署連携機能**
  - 自動通知システム: 選択確定時に工事部・仕入部等へ自動通知
  - 通知履歴管理
- **ミス・漏れ防止機能**
  - 必須選択チェッカー: 未選択の必須項目を警告
  - 完了率表示: プログレスバーで視覚化
  - 重複選択警告

### v2.12.0 (2025-12-13)
- **マルチテナント対応（フランチャイズ対応）**
  - 組織テーブル（organizations）追加
  - 組織メンバーテーブル（organization_members）追加
  - 組織別商品設定テーブル（organization_item_settings）追加
  - super_admin権限追加（Gハウス本部が全組織データ閲覧可能）
  - 組織管理UIコンポーネント追加
- **SQL統合**
  - 20+のSQLファイルをCOMPLETE_SETUP.sqlに集約
  - マルチテナント拡張SQL（MULTI_TENANT_EXTENSION.sql）追加
- **型定義拡張**
  - Organization, OrganizationMember, OrganizationItemSetting型追加
  - UserRole型にsuper_admin追加
- **AuthContext強化**
  - isSuperAdmin, canViewAllOrganizations権限追加

### v2.11.0 (2025-12-13)
- ユーザーマニュアル追加 (docs/USER_MANUAL.md)
- 管理者マニュアル追加 (docs/ADMIN_MANUAL.md)
- バックアップ・メンテナンス用SQL関数追加
- DataBackupコンポーネント強化（Supabaseデータ統計・CSV/JSONエクスポート）

### v2.10.0 (2025-12-13)
- Supabaseデータインポートスクリプト追加
- ノーコード運用対応（Supabase管理画面から商品データ編集可能）
- CatalogWithTabsのSupabase優先・静的データフォールバック方式実装
- RLSポリシー修正（匿名アクセス許可）
- 196商品・486バリアント・1,268価格レコードをSupabaseにインポート

### v2.9.0 (2025-12-12)
- ESLintエラー修正（25件→0件）
- デプロイエラー解消
- 未使用変数削除

### v2.8.0 (2025-12-11)
- 内装スタイルブック36-45ページ対応
- 収納棚・可動棚・コンポリア価格分割

### v2.7.0 (2025-12-10)
- 100点UIリデザイン
- 100社ローンチ対応
- システム完成度96点達成

## 技術スタック

### フロントエンド
- React 19.1.1
- TypeScript 5.8.3
- Vite 7.1.4
- Tailwind CSS 3.4.1
- Zustand 5.0.8（状態管理）
- React Router 7.8.2

### バックエンド
- Supabase（PostgreSQL + Auth + Storage）
- Express 5.1.0（ローカルサーバー）

### デプロイ
- Vercel
- GitHub Actions（CI/CD）

## データベース構造

### 主要テーブル
| テーブル | 説明 |
|---------|------|
| products | プラン（LACIE, HOURS, LIFE, LIFE_PLUS） |
| categories | カテゴリ（外装/内装/設備） |
| items | 商品マスター |
| item_variants | 色・バリエーション |
| item_pricing | 価格情報（プラン別） |
| projects | 物件プロジェクト |
| selections | 選択履歴 |

### データ件数（2025-12-13時点）
- カテゴリ: 38件
- 商品: 196件
- バリアント: 486件
- 価格レコード: 1,268件

## 機能一覧

### 実装済み機能
1. **商品カタログ**
   - タブ切替（外装/内装/設備）
   - カテゴリフィルタ
   - サブカテゴリフィルタ
   - 色フィルタ
   - 検索機能
   - 標準/オプション切替

2. **商品詳細**
   - 色バリエーション選択
   - 価格表示（プラン別）
   - 画像表示

3. **カート機能**
   - 商品選択・解除
   - 数量変更
   - 合計金額計算
   - 標準品一括選択

4. **見積・PDF出力**
   - 見積書生成
   - PDF出力
   - Excel出力

5. **管理機能**
   - 商品管理（CRUD）
   - カテゴリ管理
   - バリアント管理
   - 価格管理

6. **その他**
   - お気に入り
   - 最近見た商品
   - 比較機能
   - レスポンシブデザイン

## ノーコード運用ガイド

### Supabaseでのデータ管理

#### 商品追加
1. Supabaseダッシュボード → Table Editor → items
2. 「Insert row」クリック
3. 必須項目入力:
   - item_code: 商品コード（一意）
   - name: 商品名
   - category_id: カテゴリID
   - is_active: true

#### バリアント（色）追加
1. Table Editor → item_variants
2. 「Insert row」クリック
3. 必須項目入力:
   - item_id: 商品ID
   - variant_code: バリアントコード
   - color_name: 色名

#### 価格設定
1. Table Editor → item_pricing
2. 「Insert row」クリック
3. 必須項目入力:
   - item_id: 商品ID
   - variant_id: バリアントID
   - product_id: プランID
   - price: 価格

### 一括更新
- Supabase SQL Editorでクエリ実行可能
- CSVインポート機能あり

## セキュリティ

### RLSポリシー
- 商品データ: 匿名読み取り許可
- ユーザーデータ: 認証必須
- プロジェクトデータ: 所有者のみ

### 認証
- Supabase Auth使用
- Email/Password認証

## パフォーマンス

### 最適化
- コード分割（React.lazy）
- 画像遅延読み込み
- Supabaseクエリ最適化

### ビルドサイズ
- メインバンドル: 669KB
- ベンダー: 704KB（PDF関連）

## 既知の課題

1. **バンドルサイズ**: PDF関連ライブラリが大きい
2. **画像管理**: 一部商品に画像なし
3. **LIFE+プラン**: 表記ゆれ対応済み

## 今後の拡張予定

1. リアルタイム同期（Supabase Realtime）
2. プッシュ通知
3. AI商品レコメンド
4. 在庫管理連携
5. 発注システム連携

## 連絡先

- GitHub: https://github.com/Ghouse-development/IC-pochipochi-system
- 開発担当: Claude Code

---
最終更新: 2025-12-13
